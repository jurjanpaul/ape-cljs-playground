<html>
  <!--
ape-cljs-playground - Away from Preferred Editor ClojureScript Playground

This page allows you to simply try out Clojure forms on your mobile device in
moments when you don't have your laptop/desktop with preferred text editor at
hand. (You can also, for example, use it to write and run solutions for all of
the Advent of Code puzzles, https://adventofcode.com/, as I did for the 2023
edition.)

Therefore, this little project aims to provide mobile-friendly Clojure editing.
To me this means (at least):
  - Parinfer!
  - kept in (local) storage to allow for quick and easy incremental work;
  - evaluate anything that's available in (the SCI subset of) ClojureScript,
    including macros within the browser;
  - all output (including errors) displayed on the page.

Quite a number of web-based/mobile-oriented Clojure editors exist, but I haven't
yet found any that support all of the above sub-goals 'out of the box',
particularly the storage part. So, that's the itch being scratched here.

Not particularly aiming for
 - performance (just spoiled by SCI's out-of-the-box speed I guess);
 - small download size.

The project's git repository can be found at
https://github.com/jurjanpaul/ape-cljs-playground.
The page is hosted at https://jurjanpaul.github.io/ape-cljs-playground.

Currently provides
 - run ClojureScript (per SCI / Scittle, https://github.com/babashka/scittle)
   - includes macro support out-of-the-box (might require an extra reload)
 - Parinfer (per codemirror6-parinfer at
   https://github.com/jurjanpaul/codemirror6-parinfer)
 - persistence (per browser's localStorage)
 - Reagent (not essential, but did not require any extra effort per Scittle,
   plus it definitely kickstarted some dogfeeding).
   To render, simply invoke the convenience function `render-with-reagent`
   with a reagent component function as parameter.
 - trivial, but very helpful: can be saved as an 'app' on phone's home screen,
   each 'app' automagically getting its own localStorage!
 - history / undo + redo
 - Share feature that encodes code in URL, protecting the default/main buffer
   by saving changes to a new localStorage buffer after opening such an URL.
   Note: As was to be expected, large programs will result in a huge URL that
   no (mobile) browser can actually open.

Current annoyances (hopefully fixed after upgrade to CodeMirror 6):
 - After (un)zooming&scrolling, the cursor position sometimes no longer
   corresponds to the actual insertion point;
   => Unfortunately, I still haven't figured out how to deal with this,
   other than:
    - zooming out;
    - selecting another page element;
    - tilting the phone;
    - reloading the entire page...
 - Cursor position being scrolled out of focus when deleting/commenting code.
   => Improved the situation  w.r.t. vertical scrolling somewhat by tweaking
      parinfer-codemirror.js

API
 - everything that Scittle exposes, including:
     - cljs.pprint as pprint
     - clojure.string as string
     - reagent.core as r
     - reagent.dom as rdom
 - render-with-reagent

Other wishes/TODOs (nothing planned in the near future):
 - smart indentation (worked on CodeMirror 5, but not on CodeMirror 6 yet);
 - on-screen footer keyboard with opening braces + other useful special chars
 - multiple buffers
   (Hint: by saving the page multiple times to my iPhone's Home screen I
   already get multiple buffers for free!)
 - improved styling for mobile (just zoom and swipe/scroll a lot for now!);
 - Storing the history to local storage as well (used to be implemented, but
   I removed it for now, as it was no longer working reliably after the upgrade
   to CodeMirror 6, without writing a lot more code to deal with StateEffect
   (de)serialisation);
 - allow fetching existing code (gist) from url; (I included an experimental
   function `load-from-url` that would do this, but it required a rather
   ugly full reload and broke for existing code on GitHub when Scittle moved
   to match `:cljs` in reader conditionals, with the loaded code having a
   transitive dependency on the the Google Closure library...)
 - add deps (seems hard/hardly possible)
 - separate Scittle script's namespace from user entered code's namespace
 - save to gist or ... ?
 - linting

All in all I feel this is a nice showcase of what is possible with Scittle!
Thanks to all library and tool builders who made it possible for me to throw
this together so lazily!

Feel free to customize and extend this file as desired. Of course, I would
like to hear if this turns out helpful to you in any way.

  Jurjan-Paul Medema
  Github: jurjanpaul
  Twitter: @jurjanpaul
  Clojurians Slack: @jurjanpaul

P.S. Some of the alternative mobile / in-browser Clojure(Script) 'playgrounds'
that I know of:
  * http://app.klipse.tech/
  * https://borkdude.github.io/sci.web/
  * https://clojurescript.io/
  * https://nextjournal.github.io/clojure-mode/#try-it
  * https://oakes.github.io/paren-soup/
  * https://squint-cljs.github.io/squint/
  * Replete (iPhone app)

('Ape' also refers to the fact that this can indeed be considered a poor copy or
derivative of other people's hard work.)
-->
  <head>
    <title>Away from Preferred Editor ClojureScript Playground</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="url" content="https://jurjanpaul.github.io/ape-cljs-playground">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style type="text/css">
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        padding: 4px 4px 2em;
        font-family: "Open Sans", sans-serif;
      }

      button {
        border-radius: 4px;
        padding: 2px 6px 2px 6px;
      }

      .cm-editor {
        box-sizing: border-box;
        resize: both;
        border: 1px solid #aaa;
        padding: 1px;
        padding-bottom: 1em;
        min-height: 20em;
        max-height: 60vh;
      }

      .cm-editor, .cm-editor * {
         font-family: "Source Code Pro", monospace;
         font-size: 0.8rem;
      }

      .CodeMirror-matchingbracket {
        color: orange !important;
        font-weight: bold;
        background-color: lightgray;        ;
      }

      #output {
        font-family: "Source Code Pro", monospace;
        padding: 0.5em;
        padding-bottom: 1em;
        color: white;
        background-color: #120754;
        font-size: small;
        overflow-y: scroll;
        min-height: 10em;
        border-style: inset;
        border-width: 1px;
        border-radius: 5px;
        border-color: lightblue;
        resize: both;
      }

      .page-source {
        border-style: solid;
        border-width: 1px;
        padding: 0.5em;
        margin-bottom: 0.5em;
      }

      .pointer {
        cursor: pointer;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.22/dist/scittle.js" type="application/javascript"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.22/dist/scittle.reagent.js" type="application/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.22/dist/scittle.re-frame.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.22/dist/scittle.pprint.js" type="application/javascript"></script>
    <script type="importmap">
     {
       "imports": {
         "codemirror": "https://cdn.jsdelivr.net/npm/codemirror@6.0.1/dist/index.js",
         "@codemirror/commands": "https://cdn.jsdelivr.net/npm/@codemirror/commands@6.7.1/dist/index.js",
         "@codemirror/search": "https://cdn.jsdelivr.net/npm/@codemirror/search@6.5.8/dist/index.js",
         "@codemirror/autocomplete": "https://cdn.jsdelivr.net/npm/@codemirror/autocomplete@6.18.3/dist/index.js",
         "@codemirror/lint": "https://cdn.jsdelivr.net/npm/@codemirror/lint@6.8.4/dist/index.js",
         "crelt": "https://cdn.jsdelivr.net/npm/crelt@1.0.6/index.js",
         "@nextjournal/lang-clojure": "https://cdn.jsdelivr.net/npm/@nextjournal/lang-clojure@1.0.0/dist/index.js",
         "@nextjournal/lezer-clojure": "https://cdn.jsdelivr.net/npm/@nextjournal/lezer-clojure@1.0.0/dist/index.es.js",
         "@lezer/highlight": "https://cdn.jsdelivr.net/npm/@lezer/highlight@1.2.1/dist/index.js",
         "@lezer/lr": "https://cdn.jsdelivr.net/npm/@lezer/lr@1.4.2/dist/index.js",
         "@lezer/common": "https://cdn.jsdelivr.net/npm/@lezer/common@1.2.3/dist/index.js",
         "@codemirror/commands": "https://cdn.jsdelivr.net/npm/@codemirror/commands@6.7.1/dist/index.js",
         "@codemirror/language": "https://cdn.jsdelivr.net/npm/@codemirror/language@6.10.6/dist/index.js",
         "@codemirror/lint": "https://cdn.jsdelivr.net/npm/@codemirror/lint@6.8.4/dist/index.js",
         "@marijn/find-cluster-break": "https://cdn.jsdelivr.net/npm/@marijn/find-cluster-break@1.0.2",
         "@codemirror/state": "https://cdn.jsdelivr.net/npm/@codemirror/state@6.5.0/dist/index.js",
         "@codemirror/view": "https://cdn.jsdelivr.net/npm/@codemirror/view@6.35.0/dist/index.js",
         "@codemirror/merge": "https://cdn.jsdelivr.net/npm/@codemirror/merge@6.7.4/dist/index.js",
         "style-mod": "https://cdn.jsdelivr.net/npm/style-mod@4.1.2/src/style-mod.js",
         "w3c-keyname": "https://cdn.jsdelivr.net/npm/w3c-keyname@2.2.8/index.js",
         "@jurjanpaul/codemirror6-parinfer": "https://cdn.jsdelivr.net/npm/@jurjanpaul/codemirror6-parinfer@0.0.13/dist/cm6-parinfer.min.js"
       }
     }
   </script>
   <script type="module">
     import * as codemirror from 'codemirror';
     import * as cm_commands from '@codemirror/commands';
     import * as cm_language from '@codemirror/language';
     import * as cm_lint from '@codemirror/lint';
     import * as cm_view from '@codemirror/view';
     import * as cm_state from '@codemirror/state';
     import * as cm_merge from '@codemirror/merge';
     import * as lang_clojure from '@nextjournal/lang-clojure'
     import * as codemirror6_parinfer from '@jurjanpaul/codemirror6-parinfer'
     globalThis.codemirror = codemirror;
     globalThis.cm_commands = cm_commands;
     globalThis.cm_language = cm_language;
     globalThis.cm_lint = cm_lint;
     globalThis.cm_state = cm_state;
     globalThis.cm_view = cm_view;
     globalThis.cm_merge = cm_merge;
     globalThis.lang_clojure = lang_clojure;
     globalThis.codemirror6_parinfer = codemirror6_parinfer;
     scittle.core.eval_script_tags();
   </script>
   <script src="./ape.cljs" type="application/x-scittle"></script>
  </head>
  <body>
    <div id="editor"></div>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>
